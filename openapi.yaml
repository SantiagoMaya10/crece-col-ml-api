openapi: 3.0.3
info:
  title: Supersociedades ML API
  version: 1.1.0
  description: |
    REST API exposing the trained XGBoost regression model stored in `models/xgboost_model.json`.
    The service applies the same preprocessing used during training (MinMax scaling + one-hot encoding)
    starting from raw business fields.
servers:
  - url: https://<your-railway-app>.up.railway.app
    description: Railway deployment
  - url: http://localhost:8000
    description: Local development
paths:
  /:
    get:
      summary: Landing message
      responses:
        '200':
          description: API greeting
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
  /health:
    get:
      summary: Health check
      responses:
        '200':
          description: Service is ready
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
  /schema:
    get:
      summary: Feature order after preprocessing
      responses:
        '200':
          description: Ordered vector schema
          content:
            application/json:
              schema:
                type: object
                properties:
                  feature_order:
                    type: array
                    items:
                      type: string
  /predict:
    post:
      summary: Score one or more records
      description: |
        Provide raw fields; the service handles normalization and one-hot encoding to match the trained model.
        Unknown CIIU codes are mapped to `Other` (top-20 kept), and department labels are normalized.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PredictionRequest'
            example:
              records:
                - INGRESOS_OPERACIONALES: 144.82
                  TOTAL_ACTIVOS: 216.85
                  TOTAL_PASIVOS: 125.81
                  TOTAL_PATRIMONIO: 91.03
                  Year: 2022
                  TRM_Promedio: 4251.469663865546
                  IPC_Promedio: null
                  Inflacion_Promedio: 2022.0
                  Inversion_Extranjera_Total: 0.0
                  PIB_Departamental: 827.19
                  REGION: Bogot√° - Cundinamarca
                  Departamento: BOGOTA
                  MACROSECTOR: MINERO
                  CIIU: "610"
      responses:
        '200':
          description: Successful prediction
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PredictionResponse'
        '400':
          description: Validation or preprocessing error
          content:
            application/json:
              schema:
                type: object
                properties:
                  detail:
                    type: string
        '500':
          description: Server or model error
          content:
            application/json:
              schema:
                type: object
                properties:
                  detail:
                    type: string
components:
  schemas:
    PredictionRequest:
      type: object
      properties:
        records:
          type: array
          items:
            $ref: '#/components/schemas/RawRecord'
      required: [records]
    RawRecord:
      type: object
      description: Raw business fields before scaling/encoding.
      properties:
        INGRESOS_OPERACIONALES:
          type: number
        TOTAL_ACTIVOS:
          type: number
        TOTAL_PASIVOS:
          type: number
        TOTAL_PATRIMONIO:
          type: number
        Year:
          type: integer
        TRM_Promedio:
          type: number
        IPC_Promedio:
          type: number
          nullable: true
        Inflacion_Promedio:
          type: number
        Inversion_Extranjera_Total:
          type: number
        PIB_Departamental:
          type: number
        REGION:
          type: string
        Departamento:
          type: string
        MACROSECTOR:
          type: string
        CIIU:
          type: string
      required:
        - INGRESOS_OPERACIONALES
        - TOTAL_ACTIVOS
        - TOTAL_PASIVOS
        - TOTAL_PATRIMONIO
        - Year
        - TRM_Promedio
        - Inflacion_Promedio
        - Inversion_Extranjera_Total
        - PIB_Departamental
        - REGION
        - Departamento
        - MACROSECTOR
        - CIIU
    PredictionResponse:
      type: object
      properties:
        predictions:
          type: array
          items:
            type: number
          description: Model outputs in the same order as provided records
        model_version:
          type: string
          description: Nanosecond-level modification time of the model file
        feature_order:
          type: array
          items:
            type: string
          description: Ordered list of features used for inference after preprocessing
      required: [predictions, model_version, feature_order]
